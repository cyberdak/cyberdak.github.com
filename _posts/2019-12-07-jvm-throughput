---
layout : post
title : 提升jvm吞吐率
category : "jvm"
tags : [jvm,throughput]
---

吞吐率是衡量jvm在单位时间内完成了多少生产性工作的指标。那么什么是生产性工作呢

生产性工作：业务逻辑，比如计算一个用户的年龄

非生产性工作：程序的基本维护工作，大部分时间指gc垃圾回收。

假设一个程序运行了60分钟，其中2分钟在做GC。那么程序的吞吐率就等于(60-2)/60=96.67%.

## 什么情况会导致很差的吞吐率

1. 暂停时间很长的gc
2. 内存泄漏
3. 连续FULL GC
4. 高负载情况下，等待CPU和IO资源

### 1. 暂停时间很长的gc

当程序发生长时间gc时，吞吐率会严重下降。因为stw节点的jvm就是全部在做非生产性工作。

### 2. 内存泄漏

内存泄漏会导致gc算法无法找到应该被回收的对象，导致堆中的可用空间越来越少。此时jvm会不断重复进行full gc，而且最终也不能回收对象。full gc因为单线程的缘故，暂停时间特别长。对吞吐率的影响很严重。



### 3. 连续full GC

某些情况下，应用会开始连续的full gc，此时吞吐率会随着gc时间的不断增长而下降。

### 4. 系统负载过高，等待cpu和io

现代的服务器往往提供强大的多核cpu和很多的内存，也往往会运行大量程序。但是cpu和内存被其他进程耗尽时，你的程序就会处在等待的状态。此时吞吐率也会下降。

